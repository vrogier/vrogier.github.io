<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name=viewport content="width=device-width, initial-scale=1">
  
  <title>Oracle Advanced Queues support in OCILIB v3.8.0 | OCILIB (C and C++ Driver for Oracle) - Open source C and C++ library for accessing Oracle databases</title>
  
  
  <meta name="description" content="OCILIB is an open source and cross platform Oracle Driver that delivers efficient access to Oracle databases. It offers a full featured, easy and p...">
  
    <meta name="keywords" content="OCILIB, driver, Oracle, OCI, wrapper, open source, library, API, SQL, database, access , libraries, free, LGPL, GPL, PL/SQL, Oracle Call Interface">
  
    
  <link href="http://vrogier.github.io/ocilib//css/main.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link rel="canonical" href="http://vrogier.github.io/ocilib//blog/2010/oracle-advanded-queues-support-in-ocilib-v3-8-0">
  <link href="http://vrogier.github.io/ocilib//favicon.ico" rel="icon">
  <link rel="alternate" type="application/atom+xml" title="OCILIB (C and C++ Driver for Oracle) - Open source C and C++ library for accessing Oracle databases" href="http://vrogier.github.io/ocilib//atom.xml"/>
  
  <!-- Social media content metadata -->


<meta property="twitter:card" content="summary" />
<meta property="twitter:site" content="ocilib" />
<meta property="twitter:url" content="http://vrogier.github.io/ocilib/" />
<meta property="twitter:title" content="Oracle Advanced Queues support in OCILIB v3.8.0" />
<meta property="twitter:description" content="OCILIB is an open source and cross platform Oracle Driver that delivers efficient access to Oracle databases. It offers a full featured, easy and productive API. Written in ISO C and C++ on top of ..." />
<meta property="twitter:creator" content="ocilib" />
<meta property="twitter:image:src" content="" />

  
    <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-3399074-3', 'auto');
    ga('send', 'pageview');
    </script>

 
</head>
  <body>
    <main class="wrap">
      
    <header role="banner">
      <a href="http://vrogier.github.io/ocilib/"><img src="http://vrogier.github.io/ocilib//images/ocilib-header.png" srcset="http://vrogier.github.io/ocilib//images/banner-small.jpg 200w, http://vrogier.github.io/ocilib//images/banner-med.jpg 641w, http://vrogier.github.io/ocilib//images/banner-large.jpg 1025w, http://vrogier.github.io/ocilib//images/ocilib-header.png 1441w" alt="OCILIB (C and C++ Driver for Oracle) - Open source C and C++ library for accessing Oracle databases banner image" title="OCILIB (C and C++ Driver for Oracle) - Open source C and C++ library for accessing Oracle databases banner image" class="center"></a>
    </header>
  
  
      <nav class="navbar">
  <nav class="row">
    <div id="nav">
      <ul class="columns medium-8 left primary-nav">

	<li id="toggleMenu"><a href="#nav">Menu</a></li>
	<li id="hideMenu"><a href="#toggleMenu">Menu</a></li>
	
	
	  
		  
		  <li><a href="http://vrogier.github.io/ocilib//">Home</a></li>
		    
	  
	
	  
		  
		  <li><a href="http://vrogier.github.io/ocilib//features">Features</a></li>
		    
	  
	
	  
		  
		  <li><a href="http://vrogier.github.io/ocilib//download">Download</a></li>
		    
	  
	
	  
		  
		  <li><a href="http://vrogier.github.io/ocilib//documentation">Documentation</a></li>
		    
	  
	
	  
		  
		  <li><a href="http://vrogier.github.io/ocilib//support/">Support</a></li>
		    
	  
	
	  
		  
		  <li><a href="http://vrogier.github.io/ocilib//changelogs/">Changes</a></li>
		    
	  
	
	  
		  
		  <li><a href="http://vrogier.github.io/ocilib//projects/">Projects</a></li>
		    
	  
	
	  
		  
		  <li><a href="http://vrogier.github.io/ocilib//blog/">Blog</a></li>
		    
	  
	
	  
		  
		  <li><a href="http://vrogier.github.io/ocilib//about/">About</a></li>
		    
	  
	
	  
		  
		  <li><a href="http://vrogier.github.io/ocilib//comments/">Comments</a></li>
		    
	  
	
      </ul>

      <ul class="columns medium-4 right primary-nav">
	
	  <li class="right"><a href="https://chrisanthropic.github.io/slim-pickins-jekyll-theme/atom.xml"><span class="icon-feed socials"></span></a></li>
	
	  <li class="right"><a href="https://twitter.com/"><span class="icon-twitter socials"></span></a></li>
	
	  <li class="right"><a href="https://github.com/vrogier/ocilib"><span class="icon-github socials"></span></a></li>
	
      </ul>
    </div>
  </nav>
</nav>
      <article class="row post-content">

    <header>
      <h2 class="post-title">Oracle Advanced Queues support in OCILIB v3.8.0</h1>
      <p class="post-meta">Aug 26, 2010 • admin</p>
    </header>
    <br/>
toto  
tto2    
    <p>Hi,</p>

<p>Few weeks ago, in my post <a href="http://orclib.sourceforge.net/2010/06/ocilib-new-features-coming-soon/">“OCILIB new Features coming soon !”</a>, i showed a basic example of Oracle AQ support in OCILIB.</p>

<p>I’ve finished to implement all advanced queues features in OCILIB and I’m now working on writing the documentation.</p>

<p>Here is another example :)</p>

<p>In this code, we’re using a multiple consumers queue. It means that we can :</p>

<ul>
  <li>
    <p>specify the message recipient when posting the message</p>
  </li>
  <li>
    <p>specify the consumer when checking later the queue for available messages</p>
  </li>
</ul>

<p>The following complete application code (about 65 lines only without comments !!) :</p>

<ul>
  <li>
    <p>connect to the DB</p>
  </li>
  <li>
    <p>create and post a first structured message (title/content) for agent 1</p>
  </li>
  <li>
    <p>create and post a second structured message (title/content) for agent 2</p>
  </li>
  <li>
    <p>check the queue for available messages for agent 1 and agent 2</p>
  </li>
  <li>
    <p>loop and print out retrieved messages</p>
  </li>
  <li>
    <p>disconnect from DB</p>
  </li>
</ul>

<p>Advanced queues has never been so easy ;)</p>

<pre><code>#include "ocilib.h"

int main(int argc, char *argv[])
{
    OCI_Connection *con;
    OCI_Enqueue    *enq;
    OCI_Dequeue    *deq;
    OCI_Msg        *msg;
    OCI_TypeInfo   *inf;
    OCI_Object     *obj;
    OCI_Agent      *agt ;
    OCI_Agent      *tab_agt[2];
 
    /* initialize OCILIB */
    OCI_Initialize(NULL, NULL, OCI_ENV_DEFAULT);
 
    /* connect to DB */
    con = OCI_ConnectionCreate("db", "usr", "pwd", OCI_SESSION_DEFAULT);
 
    /* get message payload type information */
    inf = OCI_TypeInfoGet(con, "MY_MESSAGE", OCI_TIF_TYPE);
 
    /* create enqueue and dequeue objects for the given queue */
    enq = OCI_EnqueueCreate(inf, "my_queue_consumers");
    deq = OCI_DequeueCreate(inf, "my_queue_consumers");
 
    /* create message */
    msg = OCI_MsgCreate(inf);
    obj = OCI_ObjectCreate(con, inf);
 
    /* create 2 agents to send messages to */
    tab_agt[0] = OCI_AgentCreate(con, "AGENT1", "my_queue_consumers");
    tab_agt[1] = OCI_AgentCreate(con, "AGENT2", "my_queue_consumers");
  
    /* setup and enqueue message for consumer 1 */
    OCI_ObjectSetString(obj, "TITLE", "NEXT MEETING FOR AGENT 1");
    OCI_ObjectSetString(obj, "CONTENT", "12:00 PM IN STARBUCKS");
    OCI_MsgSetObject(msg, obj);
    OCI_MsgSetConsumers(msg, &amp;tab;_agt[0], 1);
    OCI_EnqueuePut(enq, msg);

    OCI_MsgReset(msg);

    /* setup and enqueue message for consumer 2 */
    OCI_ObjectSetString(obj, "TITLE", "NEXT MEETING FOR AGENT 2");
    OCI_ObjectSetString(obj, "CONTENT", "14:00 PM IN NERO");
    OCI_MsgSetObject(msg, obj);
    OCI_MsgSetConsumers(msg, &amp;tab;_agt[1], 1);
    OCI_EnqueuePut(enq, msg);
 
    /* free local message */
    OCI_ObjectFree(obj);
    OCI_MsgFree(msg);
 
    /* commit enqueuing */
    OCI_Commit(con);
 
    /* set list of consumers to wait message for */
    OCI_DequeueSetAgentList(deq, tab_agt, 2);
 
    /* listen for available messages */
    while (agt = OCI_DequeueListen(deq, 0))
    {
        /* inform Oracle we want to dequeue message for the given consumer */    
        OCI_DequeueSetConsumer(deq, OCI_AgentGetName(agt));
 
        /* get messages from queue */
        msg = OCI_DequeueGet(deq);
 
        if (msg == NULL)
            break;

        /* get message object payload */
        obj = OCI_MsgGetObject(msg);
 
        if (obj != NULL)
        {
            printf("'%s' : MSG '%s' =&gt; %s\n",  OCI_AgentGetName(agt),
                                               OCI_ObjectGetString(obj, "TITLE"),
                                               OCI_ObjectGetString(obj, "CONTENT"));
        }
    }

     /* commit dequeuing */
    OCI_Commit(con);

    /* free objects*/
    OCI_EnqueueFree(enq);
    OCI_DequeueFree(deq);
    OCI_AgentFree(tab_agt[0]);
    OCI_AgentFree(tab_agt[1]);
 
    /* disconnect from DB */
    OCI_ConnectionFree(con);
 
    /* cleanup OCILIB internal stuff */
    OCI_Cleanup();
 
   return EXIT_SUCCESS;
}
</code></pre>

<p>And the output is :</p>

<pre><code>MSG 'NEXT MEETING FOR AGENT 1' =&gt; 12:00 PM IN STARBUCKS
MSG 'NEXT MEETING FOR AGENT 2' =&gt; 14:00 PM IN NERO
</code></pre>

<p>Version 3.8.0 will be released by September 2010 :)</p>



</article>

    </main>
      <footer class="site-footer">
  <div class="row">
    <div >
<center>Copyright &copy; 2015 <b><a href="http://vrogier.github.io/ocilib/">OCILIB (C and C++ Driver for Oracle) - Open source C and C++ library for accessing Oracle databases</a></b>.</center>
<center>OCILIB Logo designed by <b>abecrow</b>
    </div>
  </div>
</footer> 

  </body>
</html>