<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name=viewport content="width=device-width, initial-scale=1">
  
  <title>Working with Oracle spatial types ... | OCILIB (C and C++ Driver for Oracle) - Open source C and C++ library for accessing Oracle databases</title>
  
  
  <meta name="description" content="OCILIB is an open source and cross platform Oracle Driver that delivers efficient access to Oracle databases. It offers a full featured, easy and p...">
  
    <meta name="keywords" content="OCILIB, driver, Oracle, OCI, wrapper, open source, library, API, SQL, database, access , libraries, free, LGPL, GPL, PL/SQL, Oracle Call Interface">
  
    
  <link href="http://vrogier.github.io/ocilib//css/main.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link rel="canonical" href="http://vrogier.github.io/ocilib//blog/2009/working-with-oracle-spatial-types">
  <link href="http://vrogier.github.io/ocilib//favicon.ico" rel="icon">
  <link rel="alternate" type="application/atom+xml" title="OCILIB (C and C++ Driver for Oracle) - Open source C and C++ library for accessing Oracle databases" href="http://vrogier.github.io/ocilib//atom.xml"/>
  
  <!-- Social media content metadata -->


<meta property="twitter:card" content="summary" />
<meta property="twitter:site" content="ocilib" />
<meta property="twitter:url" content="http://vrogier.github.io/ocilib/" />
<meta property="twitter:title" content="Working with Oracle spatial types ..." />
<meta property="twitter:description" content="OCILIB is an open source and cross platform Oracle Driver that delivers efficient access to Oracle databases. It offers a full featured, easy and productive API. Written in ISO C and C++ on top of ..." />
<meta property="twitter:creator" content="ocilib" />
<meta property="twitter:image:src" content="" />

  
    <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-3399074-3', 'auto');
    ga('send', 'pageview');
    </script>

 
</head>
  <body>
    <main class="wrap">
      
    <header role="banner">
      <a href="http://vrogier.github.io/ocilib/"><img src="http://vrogier.github.io/ocilib//images/ocilib-header.png" srcset="http://vrogier.github.io/ocilib//images/banner-small.jpg 200w, http://vrogier.github.io/ocilib//images/banner-med.jpg 641w, http://vrogier.github.io/ocilib//images/banner-large.jpg 1025w, http://vrogier.github.io/ocilib//images/ocilib-header.png 1441w" alt="OCILIB (C and C++ Driver for Oracle) - Open source C and C++ library for accessing Oracle databases banner image" title="OCILIB (C and C++ Driver for Oracle) - Open source C and C++ library for accessing Oracle databases banner image" class="center"></a>
    </header>
  
  
      <nav class="navbar">
  <nav class="row">
    <div id="nav">
      <ul class="columns medium-8 left primary-nav">

	<li id="toggleMenu"><a href="#nav">Menu</a></li>
	<li id="hideMenu"><a href="#toggleMenu">Menu</a></li>
	
	
	  
		  
		  <li><a href="http://vrogier.github.io/ocilib//">Home</a></li>
		    
	  
	
	  
		  
		  <li><a href="http://vrogier.github.io/ocilib//features">Features</a></li>
		    
	  
	
	  
		  
		  <li><a href="http://vrogier.github.io/ocilib//download">Download</a></li>
		    
	  
	
	  
		  
		  <li><a href="http://vrogier.github.io/ocilib//documentation">Documentation</a></li>
		    
	  
	
	  
		  
		  <li><a href="http://vrogier.github.io/ocilib//support/">Support</a></li>
		    
	  
	
	  
		  
		  <li><a href="http://vrogier.github.io/ocilib//changelogs/">Changes</a></li>
		    
	  
	
	  
		  
		  <li><a href="http://vrogier.github.io/ocilib//projects/">Projects</a></li>
		    
	  
	
	  
		  
		  <li><a href="http://vrogier.github.io/ocilib//blog/">Blog</a></li>
		    
	  
	
	  
		  
		  <li><a href="http://vrogier.github.io/ocilib//about/">About</a></li>
		    
	  
	
	  
		  
		  <li><a href="http://vrogier.github.io/ocilib//comments/">Comments</a></li>
		    
	  
	
      </ul>

      <ul class="columns medium-4 right primary-nav">
	
	  <li class="right"><a href="https://chrisanthropic.github.io/slim-pickins-jekyll-theme/atom.xml"><span class="icon-feed socials"></span></a></li>
	
	  <li class="right"><a href="https://twitter.com/"><span class="icon-twitter socials"></span></a></li>
	
	  <li class="right"><a href="https://github.com/vrogier/ocilib"><span class="icon-github socials"></span></a></li>
	
      </ul>
    </div>
  </nav>
</nav>
      <article class="row post-content">

    <header>
      <h2 class="post-title">Working with Oracle spatial types ...</h1>
      <p class="post-meta">Jul 27, 2009 â€¢ admin</p>
    </header>
    <br/>
toto  
tto2    
    <p>Few days ago, I saw thread in OTN Oracle Call Interface forum about how to handle Oracle Spacial SDO_GEOMETRY in OCI.</p>

<p>I decided to show how it could be done with OCILIB :)</p>

<p>Here is the <a href="http://www.oracle.com/technology/sample_code/products/spatial/htdocs/oci_sample/oci_sample_readme.htm">writegeom sample app from Oracle</a> rewritten with OCILIB :</p>

<ul>
  <li>
    <p>number of lines reduced by factor 4-5</p>
  </li>
  <li>
    <p>much easier code to read</p>
  </li>
  <li>
    <p>the whole sdo_object is binded to the statement</p>
  </li>
</ul>

<p>Here is the code :</p>

<pre><code>#include "ocilib.h"

#define NB_ELEM 500

void error(OCI_Error *err)
{
    printf("msg   : %s\n", OCI_ErrorGetString(err));
    exit(EXIT_FAILURE);
}

int main(int argc, char **argv)
{
    OCI_Connection *cn;
    OCI_Statement  *st;
    OCI_Object     *obj_sdo;
    OCI_Coll       *coll_inf,  *coll_ord;
    OCI_Elem       *elem_inf,  *elem_ord;
    OCI_TypeInfo   *tif_inf,   *tif_ord, *tif_sdo;

    int i;

    /* check command line */
    if (argc &lt; 3) 
    {
        fprintf(stderr, "Usage: %s user password\n", argv[0]);
        return EXIT_FAILURE;
    }

    /* init OCILIB */
    if (OCI_Initialize(error, NULL, OCI_ENV_DEFAULT))
    {
        /* connect to oracle */
        if (cn = OCI_ConnectionCreate(NULL, argv[1], argv[2], OCI_SESSION_DEFAULT))
        {
            printf ("\nConnected to Oracle.\n");

            /* retreive type info */
            tif_sdo = OCI_TypeInfoGet(cn, "MDSYS.SDO_GEOMETRY", OCI_TIF_TYPE);
            tif_inf = OCI_TypeInfoGet(cn, "MDSYS.SDO_ELEM_INFO_ARRAY", OCI_TIF_TYPE);
            tif_ord = OCI_TypeInfoGet(cn, "MDSYS.SDO_ORDINATE_ARRAY", OCI_TIF_TYPE);

            /* create sdo object */
            obj_sdo = OCI_ObjectCreate(cn, tif_sdo);

            /* create sub arrays */
            coll_inf = OCI_CollCreate(tif_inf);
            coll_ord = OCI_CollCreate(tif_ord);

            /* create sub array element accessors */
            elem_inf = OCI_ElemCreate(tif_inf);
            elem_ord = OCI_ElemCreate(tif_ord);

            /* build ordinates collection with test values */
            for (i = 0; i &lt; NB_ELEM; i++)
            {
                OCI_ElemSetDouble(elem_ord, (double) i);
                OCI_CollAppend(coll_ord, elem_ord);
                OCI_CollAppend(coll_ord, elem_ord);
            }

            /* setup information collection attribute 'starting_offset' */
            OCI_ElemSetUnsignedInt(elem_inf, 1);
            OCI_CollAppend(coll_inf, elem_inf);
            
            /* setup information collection attribute 'element_type' */
            OCI_ElemSetUnsignedInt(elem_inf, 1);
            OCI_CollAppend(coll_inf, elem_inf);
            
            /* setup information collection attribute 'interpretation' */
            OCI_ElemSetUnsignedInt(elem_inf, 1);
            OCI_CollAppend(coll_inf, elem_inf);


            /* set sdo object member attributes */
            OCI_ObjectSetInt(obj_sdo,  "SDO_GTYPE", 4);
            OCI_ObjectSetNull(obj_sdo, "SDO_SRID");
            OCI_ObjectSetNull(obj_sdo, "SDO_POINT");
            OCI_ObjectSetColl(obj_sdo, "SDO_ELEM_INFO", coll_inf);
            OCI_ObjectSetColl(obj_sdo, "SDO_ORDINATES", coll_ord);

            /*create statement object */
            st = OCI_StatementCreate(cn);

            /* prepare, bind and excute statement then commit*/
            OCI_Prepare(st, "INSERT INTO test_insert (gid, geometry) VALUES (1, :sdo)");
            OCI_BindObject(st, "sdo", obj_sdo);
            OCI_Execute(st);
            OCI_Commit(cn);

            /* free local objects */
            OCI_ObjectFree(obj_sdo);
            OCI_CollFree(coll_inf);
            OCI_CollFree(coll_ord);
            OCI_ElemFree(elem_inf);
            OCI_ElemFree(elem_ord);
        }
    }

    /* disconnect from oracle and cleanup OCILIB */
    OCI_Cleanup();

    printf ("\nDisconnected from Oracle.\n");
    
    return EXIT_SUCCESS;
} 
</code></pre>



</article>

    </main>
      <footer class="site-footer">
  <div class="row">
    <div >
<center>Copyright &copy; 2015 <b><a href="http://vrogier.github.io/ocilib/">OCILIB (C and C++ Driver for Oracle) - Open source C and C++ library for accessing Oracle databases</a></b>.</center>
<center>OCILIB Logo designed by <b>abecrow</b>
    </div>
  </div>
</footer> 

  </body>
</html>